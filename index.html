<!DOCTYPE html>
<html>
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
        <!-- <link href="style.css" rel="stylesheet" type="text/css" /> -->
        <style>
            /* CSS */

            body {
                padding-bottom: 40px;
            }

            h1 {
                margin: 40px 0;
            }

            textarea {
                background-color: #EEE;
                font-family:  monospace;
            }

            input, select {
                width:  auto !important;
                display: inline !important;
            }

            button {
                position:  relative;
                top: -2px;
            }

            .red {
                color:  red;
            }

            .green {
                color:  green;
            }
        </style>
        
        <title>IDE Setup</title>
    </head>
    <body>
        <!-- HTML -->
        <div class="container">

            <h1>HSTAT SEP IDE Setup</h1>

            <h2>Step 1: Basic Info</h2>
            <p><input id="userName" class="form-control" placeholder="Your Name">
            <button id="insertName" class="btn btn-primary">Insert Name</button></p>

            <p><input id="userEmail" class="form-control" placeholder="Your Email">
            <button id="insertEmail" class="btn btn-primary">Insert Email</button></p>

            <textarea id="gitconfig">
                git config --global user.name "X"
                git config --global user.email "X"
                git config --global pull.rebase false
                code --uninstall-extension vsls-contrib.gitdoc
            </textarea>
            <button class="btn btn-warning copy" data-clipboard-target="#gitconfig">Copy</button>
            <br><br><br>

            <h2>Step 2: SSH</h2>
            <p><a href="https://github.com/settings/tokens/new" target="_blank">Get a token</a></p>
            <ul>
                <li>Note: <strong>type anything</strong></li>
                <li>Expiration: <strong>doesn't matter</strong></li>
                <li class="red">Check: <strong>admin:public_key</strong></li>
                <li><strong class="green">Generate token</strong>, then <strong>copy it</strong></li>
            </ul>
            <p><input id="userToken" class="form-control" placeholder="Your Token">
            <button id="insertToken" class="btn btn-primary">Insert Token</button></p>
            <textarea id="ssh">
                TOKEN=X
                echo -e "\n" | ssh-keygen -t rsa -N ""
                PUBKEY=`cat ~/.ssh/id_rsa.pub`
                TITLE=`hostname`
                RESPONSE=`curl -s -H "Authorization: token ${TOKEN}" \
                -X POST --data-binary "{\"title\":\"${TITLE}\",\"key\":\"${PUBKEY}\"}" \
                https://api.github.com/user/keys`
                KEYID=`echo $RESPONSE \
                | grep -o '\"id.*' \
                | grep -o "[0-9]*" \
                | grep -m 1 "[0-9]*"`
                echo "Public key deployed to remote service"
                echo "Host github.com" >> ~/.ssh/config
                echo " Hostname ssh.github.com" >> ~/.ssh/config
                echo " Port 443" >> ~/.ssh/config
                echo " StrictHostKeyChecking no" >> ~/.ssh/config
                ssh -T git@github.com
            </textarea>
            <button class="btn btn-warning copy" data-clipboard-target="#ssh">Copy</button>
            <br><br><br>

            <h2>Step 3: Course Folder</h2>
            <select id="course" class="form-select form-select-lg">
                <option id="wd">wd</option>
                <option id="js">js</option>
                <option id="apcsa">apcsa</option>
            </select>

            <textarea id="repo">
                DIR=/workspaces
                REPO=wd
                git clone git@github.com:hstatsep/$REPO.git $DIR/$REPO
                rm -rf $DIR/$REPO/.git
                echo "Done"
            </textarea>
            <button class="btn btn-warning copy" data-clipboard-target="#repo">Copy</button>
        </div>
        
        
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.8/clipboard.min.js"></script>
        <!-- <script src="script.js"></script> -->

        <script>
            // JS
            function text100(box) {
                box.style.width = "100%";
                box.style.height = box.scrollHeight + "px";
            }

            text100(document.querySelector('#gitconfig'))
            text100(document.querySelector('#ssh'))
            text100(document.querySelector('#repo'))

            document.querySelectorAll('input').forEach(function(box){
                box.addEventListener('click',function(){
                    // alert("clicked")
                    this.select();
                })
            });

            // GIT CONFIG

            function updateGitconfig(){
                userName = document.querySelector('#userName').value;
                userEmail = document.querySelector('#userEmail').value;
                let raw = `git config --global user.name '${userName}'
git config --global user.email '${userEmail}'
git config --global pull.rebase false
code --uninstall-extension vsls-contrib.gitdoc\n`
                document.querySelector('#gitconfig').innerHTML = raw;
            }
            updateGitconfig();
            document.querySelector('#insertName').addEventListener('click',updateGitconfig);
            document.querySelector('#insertEmail').addEventListener('click',updateGitconfig);


            // SSH

            function updateSsh(){
                userToken = document.querySelector('#userToken').value;
                let raw = `TOKEN=${userToken}
echo -e "\\n" | ssh-keygen -t rsa -N ""
PUBKEY=\`cat ~/.ssh/id_rsa.pub\`
TITLE=\`hostname\`
RESPONSE=\`curl -s -H "Authorization: token \${TOKEN}" \\
-X POST --data-binary "{\\"title\\":\\"\${TITLE}\\",\\"key\\":\\"\${PUBKEY}\\"}" \\
https://api.github.com/user/keys\`
KEYID=\`echo $RESPONSE \\
| grep -o '\\"id.*' \\
| grep -o "[0-9]*" \\
| grep -m 1 "[0-9]*"\`
echo "Public key deployed to remote service"
echo "Host github.com" >> ~/.ssh/config
echo " Hostname ssh.github.com" >> ~/.ssh/config
echo " Port 443" >> ~/.ssh/config
echo " StrictHostKeyChecking no" >> ~/.ssh/config
ssh -T git@github.com\n`
                document.querySelector('#ssh').innerHTML = raw;
            }
            updateSsh();
            document.querySelector('#insertToken').addEventListener('click',updateSsh);


            function updateRepo(){
                userCourse = document.querySelector('#course').value;
                let raw = `DIR=/workspaces
REPO=${userCourse}
git clone git@github.com:hstatsep/$REPO.git $DIR/$REPO
rm -rf $DIR/$REPO/.git
echo "Done"\n`
                document.querySelector('#repo').innerHTML = raw;
            }
            // REPO
            document.querySelector("#course").addEventListener("change",updateRepo);
            updateRepo();

            // COPY


            var clipboard = new Clipboard('.copy');

            clipboard.on('success', function(e) {
                console.info('Action:', e.action);
                console.info('Text:', e.text);
                console.info('Trigger:', e.trigger);

                e.clearSelection();
            });

            clipboard.on('error', function(e) {
                console.error('Action:', e.action);
                console.error('Trigger:', e.trigger);
            });

            
        </script>
    </body>
</html>