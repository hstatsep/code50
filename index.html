<!DOCTYPE html>
<html>
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
        <!-- <link href="style.css" rel="stylesheet" type="text/css" /> -->
        <style>
            /* CSS */

            body {
                padding-bottom: 40px;
            }

            h1 {
                margin: 40px 0;
            }

            textarea {
                background-color: #EEE;
                font-family:  monospace;
            }

            input, select {
                width:  auto !important;
                display: inline !important;
            }

            button {
                position:  relative;
                top: -2px;
            }

            .red {
                color:  red;
            }

            .green {
                color:  green;
            }
        </style>
        
        <title>IDE Setup</title>
    </head>
    <body>
        <!-- HTML -->
        <div class="container">

            <h1>HSTAT SEP IDE Setup</h1>

            <h2>Step 1: Basic Info</h2>
            <p><input id="userName" class="form-control" placeholder="Your Name">
            <button id="insertName" class="btn btn-primary">Insert Name</button></p>

            <p><input id="userEmail" class="form-control" placeholder="Your Email">
            <button id="insertEmail" class="btn btn-primary">Insert Email</button></p>

            <textarea id="gitconfig">
                git config --global user.name "X"
                git config --global user.email "X"
                git config --global pull.rebase false
                code --uninstall-extension vsls-contrib.gitdoc
                printf "{\n\t\"gitdoc.enabled\": false,\n\t\"editor.wordWrap\": true\n}" > .vscode/settings.json
            </textarea>
            <button class="btn btn-warning copy" data-clipboard-target="#gitconfig">Copy</button>
            <br><br><br>

            <h2>Step 2: SSH</h2>
            <p><a href="https://github.com/settings/tokens/new" target="_blank">Get a token</a></p>
            <ul>
                <li>Note: <strong>type anything</strong></li>
                <li>Expiration: <strong>doesn't matter</strong></li>
                <li class="red">Check: <strong>admin:public_key</strong></li>
                <li><strong class="green">Generate token</strong>, then <strong>copy it</strong></li>
                <div class="alert alert-warning" role="alert">
                    <p class="mb-0">Note: in a few days, you will get an email with the following text.</em> <strong>You can ignore it.</strong></p>
                    <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;<em>We noticed your personal access token (classic) "x" with admin:public_key scope will expire in 7 days</em></p>
                </div>
                <!-- <ul>
                    <li><em>Note: in a few days, you will get an email with the following text.</em> <strong>You can ignore it.</strong></li>
                    <blockquote class="blockquote">
                        <small class="mb-0 text-light bg-secondary p-1">We noticed your personal access token (classic) "x" with admin:public_key scope will expire in 7 days.</small>
                    </blockquote>
                </ul> -->
            </ul>
            <p><input id="userToken" class="form-control" placeholder="Your Token">
            <button id="insertToken" class="btn btn-primary">Insert Token</button></p>
            <textarea id="ssh">
                TOKEN=X
                echo -e "\n" | ssh-keygen -t rsa -N ""
                PUBKEY=`cat ~/.ssh/id_rsa.pub`
                TITLE=`hostname`
                RESPONSE=`curl -s -H "Authorization: token ${TOKEN}" \
                -X POST --data-binary "{\"title\":\"${TITLE}\",\"key\":\"${PUBKEY}\"}" \
                https://api.github.com/user/keys`
                KEYID=`echo $RESPONSE \
                | grep -o '\"id.*' \
                | grep -o "[0-9]*" \
                | grep -m 1 "[0-9]*"`
                echo "Public key deployed to remote service"
                echo "Host github.com" >> ~/.ssh/config
                echo " Hostname ssh.github.com" >> ~/.ssh/config
                echo " Port 443" >> ~/.ssh/config
                echo " StrictHostKeyChecking no" >> ~/.ssh/config
                ssh -T git@github.com
            </textarea>
            <button class="btn btn-warning copy" data-clipboard-target="#ssh">Copy</button>
            <br>
            <div class="alert alert-danger" role="alert">
                <strong>IMPORTANT</strong>: if you do not use your IDE for a long period of time, you will receive an email warning you that your IDE will be reset if you do not log in. All you have to do is login. Failure to do so means:
                <ul>
                    <li>You will lose all of your work (as a general habit, make sure you are frequently pushing to you repos.</li>
                    <li>You will have to follow the steps on this page again (and re-clone any repos you want to work on).</li>
                </ul>
                <!-- <p>Click here to see what this email looks like.</p> -->
                
                <!-- Button trigger modal -->
                <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#exampleModal">
                    Click here to see what the email looks like.
                </button>
                
                <!-- Modal -->
                <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Example email</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <img src="ide-deleted-warning.png" class="img-fluid">
                        </div>
                        <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
                        </div>
                    </div>
                    </div>
                </div>
                <!-- ide-deleted-warning.png -->
            </div>
            <br><br><br>

            <h2>Step 3: Course Folder</h2>
            <select id="course" class="form-select form-select-lg">
                <option id="wd">wd</option>
                <option id="js">js</option>
                <option id="apcsa">apcsa</option>
            </select>

            <textarea id="repo">
                DIR=/workspaces
                REPO=wd
                git clone git@github.com:hstatsep/$REPO.git $DIR/$REPO
                rm -rf $DIR/$REPO/.git
                echo "Done"
            </textarea>
            <button class="btn btn-warning copy" data-clipboard-target="#repo">Copy</button>
        </div>
        
        
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.8/clipboard.min.js"></script>
        <!-- <script src="script.js"></script> -->

        <script>
            // JS
            function text100(box) {
                box.style.width = "100%";
                box.style.height = box.scrollHeight + "px";
            }

            text100(document.querySelector('#gitconfig'))
            text100(document.querySelector('#ssh'))
            text100(document.querySelector('#repo'))

            document.querySelectorAll('input').forEach(function(box){
                box.addEventListener('click',function(){
                    // alert("clicked")
                    this.select();
                })
            });

            // GIT CONFIG

            function updateGitconfig(){
                userName = document.querySelector('#userName').value;
                userEmail = document.querySelector('#userEmail').value;
                let raw = `git config --global user.name '${userName}'
git config --global user.email '${userEmail}'
git config --global pull.rebase false
code --uninstall-extension vsls-contrib.gitdoc
printf "{\\n\\t\\"gitdoc.enabled\\": false,\\n\\t\\"editor.wordWrap\\": true\\n}" > .vscode/settings.json\n`
                document.querySelector('#gitconfig').innerHTML = raw;
            }
            updateGitconfig();
            document.querySelector('#insertName').addEventListener('click',updateGitconfig);
            document.querySelector('#insertEmail').addEventListener('click',updateGitconfig);


            // SSH

            function updateSsh(){
                userToken = document.querySelector('#userToken').value;
                let raw = `TOKEN=${userToken}
echo -e "\\n" | ssh-keygen -t rsa -N ""
PUBKEY=\`cat ~/.ssh/id_rsa.pub\`
TITLE=\`hostname\`
RESPONSE=\`curl -s -H "Authorization: token \${TOKEN}" \\
-X POST --data-binary "{\\"title\\":\\"\${TITLE}\\",\\"key\\":\\"\${PUBKEY}\\"}" \\
https://api.github.com/user/keys\`
KEYID=\`echo $RESPONSE \\
| grep -o '\\"id.*' \\
| grep -o "[0-9]*" \\
| grep -m 1 "[0-9]*"\`
echo "Public key deployed to remote service"
echo "Host github.com" >> ~/.ssh/config
echo " Hostname ssh.github.com" >> ~/.ssh/config
echo " Port 443" >> ~/.ssh/config
echo " StrictHostKeyChecking no" >> ~/.ssh/config
ssh -T git@github.com\n`
                document.querySelector('#ssh').innerHTML = raw;
            }
            updateSsh();
            document.querySelector('#insertToken').addEventListener('click',updateSsh);


            function updateRepo(){
                userCourse = document.querySelector('#course').value;
                let raw = `DIR=/workspaces
REPO=${userCourse}
git clone git@github.com:hstatsep/$REPO.git $DIR/$REPO
rm -rf $DIR/$REPO/.git
echo "Done"\n`
                document.querySelector('#repo').innerHTML = raw;
            }
            // REPO
            document.querySelector("#course").addEventListener("change",updateRepo);
            updateRepo();

            // COPY


            var clipboard = new Clipboard('.copy');

            clipboard.on('success', function(e) {
                console.info('Action:', e.action);
                console.info('Text:', e.text);
                console.info('Trigger:', e.trigger);

                e.clearSelection();
            });

            clipboard.on('error', function(e) {
                console.error('Action:', e.action);
                console.error('Trigger:', e.trigger);
            });

            
        </script>
    </body>
</html>